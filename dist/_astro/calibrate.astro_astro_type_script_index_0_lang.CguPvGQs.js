import{s as u}from"./supabase.DtsjVctq.js";const y="https://image.tmdb.org/t/p/w342",p=localStorage.getItem("gw_user_id")||(()=>{const e="anon_"+Math.random().toString(36).slice(2);return localStorage.setItem("gw_user_id",e),e})();let n=[],c=0;const v=10;let d=new Set,b=Date.now();const l=document.getElementById("comparison-area"),m=document.getElementById("alt-buttons"),h=document.getElementById("complete-state"),f=document.getElementById("progress-bar"),_=document.getElementById("progress-count");async function w(){const{data:e}=await u.from("movies").select("id,title,poster_path,vote_average,release_date").not("poster_path","is",null).gte("vote_average",6.5).order("vote_average",{ascending:!1}).limit(100);n=(e||[]).sort(()=>Math.random()-.5);const{data:t}=await u.from("comparisons").select("movie_a_id,movie_b_id").eq("user_id",p);t?.forEach(o=>d.add([o.movie_a_id,o.movie_b_id].sort().join("-"))),g()}function x(){for(let e=0;e<n.length;e++)for(let t=e+1;t<n.length;t++){const o=[n[e].id,n[t].id].sort().join("-");if(!d.has(o))return[n[e],n[t]]}return null}function g(){if(c>=v){l.style.display="none",m.style.display="none",h.style.display="block";return}const e=x();if(!e){l.innerHTML='<p class="text-center text-gw-text-secondary py-12">No more pairs!</p>',m.style.display="none";return}const[t,o]=e;b=Date.now(),m.style.display="flex",l.innerHTML=`<div class="text-center text-gw-text-secondary mb-6">Which would you rather watch?</div><div class="grid grid-cols-2 gap-4 md:gap-8">${[["a",t],["b",o]].map(([s,a])=>`<button class="movie-choice group" data-choice="${s}" data-a="${t.id}" data-b="${o.id}"><div class="relative rounded-xl overflow-hidden transition-all group-hover:ring-2 group-hover:ring-gw-accent group-hover:scale-[1.02]"><img src="${y}${a.poster_path}" alt="${a.title}" class="w-full aspect-[2/3] object-cover"><div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div><div class="absolute top-3 left-3 w-8 h-8 bg-gw-accent rounded-full flex items-center justify-center font-bold text-gw-bg text-sm">${s.toUpperCase()}</div><div class="absolute bottom-0 left-0 right-0 p-4"><h3 class="font-bold text-sm md:text-base leading-tight">${a.title}</h3><div class="flex items-center gap-2 text-xs text-white/70 mt-1"><span class="text-yellow-400">â˜…</span><span>${a.vote_average?.toFixed(1)}</span>${a.release_date?`<span>${a.release_date.slice(0,4)}</span>`:""}</div></div></div></button>`).join("")}</div>`,document.querySelectorAll(".movie-choice").forEach(s=>s.addEventListener("click",a=>{const r=a.currentTarget;i(r.dataset.a,r.dataset.b,r.dataset.choice)}))}async function i(e,t,o){d.add([e,t].sort().join("-")),await u.from("comparisons").insert({user_id:p,movie_a_id:e,movie_b_id:t,chosen:o,comparison_type:"calibration",time_to_decision_ms:Date.now()-b}),c++,f.style.width=`${c/v*100}%`,_.textContent=String(c),(o==="a"||o==="b")&&document.querySelectorAll(".movie-choice").forEach((s,a)=>{o==="a"&&a===0||o==="b"&&a===1?s.querySelector("div")?.classList.add("ring-4","ring-green-500"):s.style.opacity="0.3"}),setTimeout(g,400)}document.getElementById("btn-both").onclick=()=>{const e=document.querySelector(".movie-choice");e&&i(e.dataset.a,e.dataset.b,"both")};document.getElementById("btn-neither").onclick=()=>{const e=document.querySelector(".movie-choice");e&&i(e.dataset.a,e.dataset.b,"neither")};document.getElementById("btn-skip").onclick=()=>{const e=document.querySelector(".movie-choice");e&&(d.add([e.dataset.a,e.dataset.b].sort().join("-")),g())};document.onkeydown=e=>{const t=document.querySelector(".movie-choice");t&&(e.key==="ArrowLeft"||e.key==="1"?i(t.dataset.a,t.dataset.b,"a"):(e.key==="ArrowRight"||e.key==="2")&&i(t.dataset.a,t.dataset.b,"b"))};w();
