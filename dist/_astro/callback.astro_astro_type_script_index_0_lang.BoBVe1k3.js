import{c as d}from"./wrapper.LS5g8wYr.js";const u="https://jdjqrlkynwfhbtyuddjk.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkanFybGt5bndmaGJ0eXVkZGprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NzUwMTEsImV4cCI6MjA4MDA1MTAxMX0.KDRMLCewVMp3lwphkUvtoWOkg6kyAk8iSbVkRKiHYSk",r=d(u,l);async function p(){try{const o=new URLSearchParams(window.location.hash.substring(1)),n=new URLSearchParams(window.location.search),t=o.get("error")||n.get("error");if(t){console.error("Auth error:",t),window.location.href="/?auth_error="+encodeURIComponent(t);return}const i=n.get("code");if(i){const{error:a}=await r.auth.exchangeCodeForSession(i);if(a){console.error("Code exchange error:",a),window.location.href="/?auth_error="+encodeURIComponent(a.message);return}}const{data:{session:e}}=await r.auth.getSession();if(e?.user){const a=localStorage.getItem("goodwatch_taste");if(a){const s=JSON.parse(a);await r.from("users").upsert({id:e.user.id,email:e.user.email,display_name:e.user.user_metadata?.full_name||e.user.user_metadata?.name,avatar_url:e.user.user_metadata?.avatar_url||e.user.user_metadata?.picture,auth_provider:e.user.app_metadata?.provider||"email",taste_profile:s.tasteProfile||{},saved_movies:s.savedMovies||[],skipped_movies:s.skippedMovies||[],updated_at:new Date().toISOString()});const c=localStorage.getItem("goodwatch_anon_id");await r.from("auth_analytics").insert({event_type:"signup_completed",auth_provider:e.user.app_metadata?.provider||"email",anonymous_id:c,user_id:e.user.id,page_url:"/auth/callback"})}window.location.href="/?signed_in=true"}else window.location.href="/"}catch(o){console.error("Auth callback error:",o),window.location.href="/?auth_error=unexpected"}}p();
