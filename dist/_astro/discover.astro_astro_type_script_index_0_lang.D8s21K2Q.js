import{s as m}from"./supabase.DtsjVctq.js";const I="https://image.tmdb.org/t/p/w500";let u=[],r=0,p="",d={liked:0,passed:0,loved:0};const f=localStorage.getItem("gw_user_id")||(()=>{const e="anon_"+Math.random().toString(36).slice(2);return localStorage.setItem("gw_user_id",e),e})(),S=crypto.randomUUID();let _=Date.now();const v=document.getElementById("card-stack");async function k(){v.innerHTML='<div class="absolute inset-0 flex items-center justify-center"><div class="animate-spin rounded-full h-12 w-12 border-4 border-gw-accent border-t-transparent"></div></div>';const{data:e}=await m.from("swipes").select("movie_id").eq("user_id",f),t=new Set(e?.map(n=>n.movie_id)||[]),{data:o}=await m.from("movies").select("id,title,poster_path,vote_average,release_date,genres,movie_axes(warmth,suspense,humor,darkness,complexity)").not("poster_path","is",null).gte("vote_average",6).order("vote_average",{ascending:!1}).limit(60);u=(o||[]).filter(n=>!t.has(n.id)).sort(()=>Math.random()-.5),r=0,E()}function E(){if(r>=u.length){v.innerHTML='<div class="text-center py-12"><div class="text-5xl mb-4">ðŸŽ¬</div><h2 class="text-xl font-bold mb-2">All done!</h2><button onclick="location.reload()" class="bg-gw-accent text-gw-bg px-6 py-2 rounded-full mt-4">Load More</button></div>';return}const e=u[r],t=e.movie_axes?.[0];_=Date.now();const o=t?[t.warmth>=7&&"Heartwarming",t.suspense>=7&&"Suspenseful",t.humor>=7&&"Funny",t.darkness>=7&&"Dark",t.complexity>=7&&"Complex"].filter(Boolean).slice(0,3):[];v.innerHTML=`<div id="card" class="absolute inset-0 flex items-center justify-center"><div class="w-full max-w-sm cursor-grab touch-none select-none"><div class="relative rounded-2xl overflow-hidden shadow-2xl bg-gw-card"><div class="aspect-[2/3] relative"><img src="${I}${e.poster_path}" alt="${e.title}" class="w-full h-full object-cover" draggable="false"><div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div><div id="ind-like" class="absolute inset-0 bg-green-500/30 flex items-center justify-center opacity-0"><span class="text-4xl font-bold text-green-500 -rotate-12">LIKE</span></div><div id="ind-pass" class="absolute inset-0 bg-red-500/30 flex items-center justify-center opacity-0"><span class="text-4xl font-bold text-red-500 rotate-12">PASS</span></div><div id="ind-love" class="absolute inset-0 bg-yellow-500/30 flex items-center justify-center opacity-0"><span class="text-4xl font-bold text-yellow-500">LOVE</span></div><div class="absolute bottom-0 left-0 right-0 p-5"><h2 class="text-xl font-bold mb-1">${e.title}</h2><div class="flex items-center gap-2 text-sm text-white/80"><span class="text-yellow-400">â˜…</span><span>${e.vote_average?.toFixed(1)}</span>${e.release_date?`<span>â€¢ ${e.release_date.slice(0,4)}</span>`:""}</div>${o.length?`<div class="flex gap-2 mt-2">${o.map(n=>`<span class="px-2 py-0.5 bg-white/20 rounded text-xs">${n}</span>`).join("")}</div>`:""}</div></div></div></div></div>`,$()}function $(){const e=document.getElementById("card");if(!e)return;let t=0,o=0,n=0,a=0,c=!1;const y=(s,l)=>{t=s,o=l,c=!0},x=(s,l)=>{if(!c)return;n=s-t,a=l-o,e.style.transform=`translate(${n}px,${a}px) rotate(${n*.1}deg)`;const w=document.getElementById("ind-like"),b=document.getElementById("ind-pass"),h=document.getElementById("ind-love");w&&(w.style.opacity=n>50?String(Math.min((n-50)/50,1)):"0"),b&&(b.style.opacity=n<-50?String(Math.min((-n-50)/50,1)):"0"),h&&(h.style.opacity=a<-50?String(Math.min((-a-50)/50,1)):"0")},g=()=>{c&&(c=!1,n>100?i("right"):n<-100?i("left"):a<-100?i("up"):(e.style.transform="",["ind-like","ind-pass","ind-love"].forEach(s=>{const l=document.getElementById(s);l&&(l.style.opacity="0")})),n=a=0)};e.onmousedown=s=>y(s.clientX,s.clientY),e.onmousemove=s=>x(s.clientX,s.clientY),e.onmouseup=g,e.onmouseleave=g,e.ontouchstart=s=>y(s.touches[0].clientX,s.touches[0].clientY),e.ontouchmove=s=>x(s.touches[0].clientX,s.touches[0].clientY),e.ontouchend=g}async function i(e){const t=u[r];if(!t)return;const o=document.getElementById("card");o&&(o.style.transition="transform 0.3s",o.style.transform=`translate(${e==="right"?500:e==="left"?-500:0}px,${e==="up"?-500:0}px) rotate(${e==="right"?30:e==="left"?-30:0}deg)`),e==="right"?d.liked++:e==="up"?d.loved++:d.passed++,document.getElementById("liked-count").textContent=String(d.liked),document.getElementById("loved-count").textContent=String(d.loved),document.getElementById("passed-count").textContent=String(d.passed),await m.from("swipes").insert({user_id:f,movie_id:t.id,direction:e,mood_slug:p||null,session_id:S,position_in_session:r,time_to_decision_ms:Date.now()-_}),e!=="left"&&await m.from("user_watchlist").upsert({user_id:f,movie_id:t.id,added_from:"swipe",mood_when_added:p||null},{onConflict:"user_id,movie_id"}),setTimeout(()=>{r++,E()},300)}document.getElementById("btn-pass").onclick=()=>i("left");document.getElementById("btn-like").onclick=()=>i("right");document.getElementById("btn-love").onclick=()=>i("up");document.querySelectorAll(".mood-btn").forEach(e=>e.addEventListener("click",()=>{document.querySelectorAll(".mood-btn").forEach(t=>{t.classList.remove("active","bg-gw-accent","text-gw-bg"),t.classList.add("bg-gw-card","border","border-gw-border")}),e.classList.add("active","bg-gw-accent","text-gw-bg"),e.classList.remove("bg-gw-card","border","border-gw-border"),p=e.dataset.mood||"",k()}));document.onkeydown=e=>{e.key==="ArrowLeft"?i("left"):e.key==="ArrowRight"?i("right"):e.key==="ArrowUp"&&i("up")};k();
