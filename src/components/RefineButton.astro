---
// RefineButton.astro - Allows user to update taste preferences
// Shows only if user has profile data
---

<button 
  id="refine-taste-btn" 
  class="hidden text-sm text-gw-text-secondary hover:text-gw-accent transition flex items-center gap-1"
>
  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
  </svg>
  Refine taste
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('refine-taste-btn');
    const tasteData = JSON.parse(localStorage.getItem('goodwatch_taste') || '{}');
    
    // Show button only if user has completed profile
    if (tasteData.tasteProfile?.likedMovies?.length > 0) {
      btn?.classList.remove('hidden');
    }
    
    btn?.addEventListener('click', () => {
      // Clear the "seen" flag to show modal again
      const data = JSON.parse(localStorage.getItem('goodwatch_taste') || '{}');
      data.hasSeenTasteModal = false;
      data.tasteModalSkippedAt = null;
      localStorage.setItem('goodwatch_taste', JSON.stringify(data));
      
      // Reload to trigger modal
      window.location.reload();
    });
  });
</script>
